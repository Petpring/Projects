<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการห้องเรียน</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.4.10/dist/vuetify.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.4.10/dist/vuetify.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="app">
        <v-app>
            <v-container>
                <h2 class="text-h4 font-weight-bold">ระบบจัดการห้องเรียน</h2>
                <v-card class="pa-4 mt-4">
                    <div v-if="!user">
                        <p>กรุณาเข้าสู่ระบบ</p>
                        <v-btn v-else color="green" @click="loginWithGoogle">เข้าสู่ระบบด้วย Google</v-btn>
                    </v-col>
                    </div>
                    <div v-else>
                        
                        <v-row >
                            <v-col cols="auto">
                                <v-avatar size="50">
                                    <img :src="user.photoURL" />
                                </v-avatar>
                            </v-col>
                            <v-col>
                                <p>{{ user.displayName }} ({{ user.email }})</p>
                            </v-col>
                        </v-row>
                        <v-btn @click="logout" color="red">ออกจากระบบ</v-btn>
                        <v-btn color="blue" class="ml-2" onclick="window.location.href='Kim/public/add_classroom.html'">เพิ่มวิชา</v-btn>
                        <v-btn color="gray" class="ml-2" onclick="window.location.href='Kim/public/edit_profile.html'">แก้ไขข้อมูลส่วนตัว</v-btn>
                    </div>
                </v-card>
                <h3 class="text-h5 mt-5 font-weight-bold">รายชื่อวิชาที่สอน</h3>
                <v-card v-for="course in courses" :key="course.id" class="pa-3 mt-2">
                    <p>{{ course.name }}</p>
                </v-card>
            </v-container>
        </v-app>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBcU6xE0qaj_Cm2CQrPsMvyDSEg8zsWX_c",
            authDomain: "sc362202project2024.firebaseapp.com",
            projectId: "sc362202project2024",
            storageBucket: "sc362202project2024.firebasestorage.app",
            messagingSenderId: "1073660061425",
            appId: "1:1073660061425:web:de231b427a0c34a6d16b50"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        const app = Vue.createApp({
            data() {
                return {
                    user: null,
                    classrooms: []
                };
            },
            mounted() {
                auth.onAuthStateChanged(user => {
                    this.user = user ? user.toJSON() : null;
                    if (user) this.loadClassrooms(user.uid);
                });
            },
            methods: {
                loginWithGoogle() {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    auth.signInWithPopup(provider);
                },
                logout() {
                    auth.signOut();
                },
                loadClassrooms(uid) {
                    db.collection("users").doc(uid).collection("classroom").get()
                        .then(snapshot => {
                            this.classrooms = [];
                            snapshot.forEach(doc => {
                                const cid = doc.id;
                                db.collection("classroom").doc(cid).get()
                                    .then(classroomDoc => {
                                        if (classroomDoc.exists) {
                                            this.classrooms.push({ id: cid, ...classroomDoc.data() });
                                        }
                                    });
                            });
                        });
                },
                manageClassroom(cid) {
                    window.location.href = `classroom.html?cid=${cid}`;
                },
                goTo(url) {
                    window.location.href = url;
                }
            }
        });
        
        app.use(Vuetify.createVuetify()).mount("#app");
    </script>
</body>
</html>
